<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bone Fracture Analysis - Pipeline</title>
  <link rel="stylesheet" href="/styles-pipeline.css">
</head>
<body>
  <div class="container">
    <h1>Ph√¢n t√≠ch ph√°t hi·ªán g√£y x∆∞∆°ng - Pipeline</h1>
    
    <!-- Progress Tracker -->
    <div id="progressTracker" class="progress-tracker" style="display: none;">
      <div class="progress-step" data-step="1">
        <div class="progress-circle">1</div>
        <div class="progress-label">Ti·ªÅn x·ª≠ l√Ω</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="2">
        <div class="progress-circle">2</div>
        <div class="progress-label">Ph√°t hi·ªán bi√™n</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="3">
        <div class="progress-circle">3</div>
        <div class="progress-label">H√¨nh th√°i h·ªçc</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="4">
        <div class="progress-circle">4</div>
        <div class="progress-label">ƒê·∫∑c tr∆∞ng</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="5">
        <div class="progress-circle">5</div>
        <div class="progress-label">K·∫øt lu·∫≠n</div>
      </div>
    </div>
    
    <!-- Upload Section -->
    <div class="panel upload-panel">
      <h2>üì§ B∆∞·ªõc 0: Upload ·∫£nh X-quang</h2>
      <p class="step-description">Ch·ªçn ·∫£nh X-quang ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch</p>
      <input type="file" id="fileInput" accept="image/*" style="display: none;">
      <button id="uploadBtn" class="btn btn-primary">Ch·ªçn ·∫£nh</button>
      <div id="originalPreview" class="image-preview">
        <img id="originalImg" src="" alt="Original image">
      </div>
    </div>

    <!-- Pipeline Steps -->
    <div id="pipelineSteps" class="pipeline-container" style="display: none;">
      
      <!-- Step 1: Preprocessing -->
      <div class="panel step-panel step-incomplete" id="step1">
        <div class="step-header">
          <h2>üîß B∆∞·ªõc 1: Ti·ªÅn x·ª≠ l√Ω</h2>
          <span class="step-status" id="status1">Ch∆∞a ho√†n th√†nh</span>
        </div>
        <p class="step-description">C·∫£i thi·ªán ch·∫•t l∆∞·ª£ng ·∫£nh tr∆∞·ªõc khi ph√¢n t√≠ch. Ch·ªçn m·ªôt thu·∫≠t to√°n v√† nh·∫•n "X·ª≠ l√Ω".</p>
        
        <div class="step-content">
          <div class="algorithm-select">
            <label><strong>Ch·ªçn thu·∫≠t to√°n:</strong></label>
            <select id="preprocessingAlgo" class="algo-select">
              <option value="">-- Ch·ªçn thu·∫≠t to√°n ti·ªÅn x·ª≠ l√Ω --</option>
              <option value="clahe">CLAHE - Adaptive Histogram Equalization</option>
              <option value="histogram">Histogram Equalization - C√¢n b·∫±ng to√†n c·ª•c</option>
              <option value="median">Median Blur - L·ªçc nhi·ªÖu mu·ªëi ti√™u</option>
              <option value="gaussian">Gaussian Blur - L√†m m∆∞·ª£t ·∫£nh</option>
              <option value="bilateral">Bilateral Filter - L√†m m∆∞·ª£t gi·ªØ c·∫°nh</option>
            </select>
            <button class="btn btn-process" data-step="preprocessing">
              ‚ñ∂Ô∏è X·ª≠ l√Ω B∆∞·ªõc 1
            </button>
          </div>
          
          <div class="result-container" id="resultContainer1" style="display: none;">
            <h4>‚úÖ K·∫øt qu·∫£ B∆∞·ªõc 1:</h4>
            <div class="result-preview">
              <img id="result1" src="" alt="Step 1 result">
            </div>
            <p class="result-hint">üëÜ ·∫¢nh ƒë√£ ƒë∆∞·ª£c ti·ªÅn x·ª≠ l√Ω. B∆∞·ªõc ti·∫øp theo s·∫Ω xu·∫•t hi·ªán b√™n d∆∞·ªõi.</p>
          </div>
        </div>
      </div>

      <!-- Step 2: Edge Detection -->
      <div class="panel step-panel step-incomplete" id="step2" style="display: none;">
        <div class="step-header">
          <h2>üîç B∆∞·ªõc 2: Ph√°t hi·ªán bi√™n</h2>
          <span class="step-status" id="status2">Ch∆∞a ho√†n th√†nh</span>
        </div>
        <p class="step-description">Ph√°t hi·ªán bi√™n v√† v√πng nghi ng·ªù. Ch·ªçn thu·∫≠t to√°n v√† nh·∫•n "X·ª≠ l√Ω".</p>
        
        <div class="step-content">
          <div class="algorithm-select">
            <label><strong>Ch·ªçn thu·∫≠t to√°n:</strong></label>
            <select id="edgeDetectionAlgo" class="algo-select">
              <option value="">-- Ch·ªçn thu·∫≠t to√°n ph√°t hi·ªán bi√™n --</option>
              <option value="otsu">Otsu Thresholding - Ng∆∞·ª°ng h√≥a t·ª± ƒë·ªông</option>
              <option value="canny">Canny Edge Detection - Ph√°t hi·ªán bi√™n ch√≠nh x√°c</option>
              <option value="sobel">Sobel Edge Detection - Ph√°t hi·ªán bi√™n ƒë∆°n gi·∫£n</option>
              <option value="watershed">Watershed Segmentation - Ph√¢n v√πng watershed</option>
            </select>
            <button class="btn btn-process" data-step="edgeDetection">
              ‚ñ∂Ô∏è X·ª≠ l√Ω B∆∞·ªõc 2
            </button>
          </div>
          
          <div class="result-container" id="resultContainer2" style="display: none;">
            <h4>‚úÖ K·∫øt qu·∫£ B∆∞·ªõc 2:</h4>
            <div class="result-preview">
              <img id="result2" src="" alt="Step 2 result">
            </div>
            <p class="result-hint">üëÜ ·∫¢nh ƒë√£ ph√°t hi·ªán bi√™n. B∆∞·ªõc ti·∫øp theo s·∫Ω xu·∫•t hi·ªán b√™n d∆∞·ªõi.</p>
          </div>
        </div>
      </div>

      <!-- Step 3: Morphology -->
      <div class="panel step-panel step-incomplete" id="step3" style="display: none;">
        <div class="step-header">
          <h2>‚öôÔ∏è B∆∞·ªõc 3: X·ª≠ l√Ω h√¨nh th√°i h·ªçc</h2>
          <span class="step-status" id="status3">Ch∆∞a ho√†n th√†nh</span>
        </div>
        <p class="step-description">L√†m s·∫°ch v√† c·∫£i thi·ªán mask nh·ªã ph√¢n. Ch·ªçn ph√©p to√°n v√† ƒëi·ªÅu ch·ªânh tham s·ªë.</p>
        
        <div class="step-content">
          <div class="algorithm-select">
            <label><strong>Ch·ªçn ph√©p to√°n:</strong></label>
            <select id="morphologyAlgo" class="algo-select">
              <option value="">-- Ch·ªçn ph√©p to√°n h√¨nh th√°i h·ªçc --</option>
              <option value="erosion">Erosion - Co v√πng, lo·∫°i nhi·ªÖu nh·ªè</option>
              <option value="dilation">Dilation - M·ªü r·ªông v√πng, n·ªëi c√°c v√πng</option>
              <option value="opening">Opening - Erosion ‚Üí Dilation (lo·∫°i nhi·ªÖu)</option>
              <option value="closing">Closing - Dilation ‚Üí Erosion (l·∫•p l·ªó h·ªïng)</option>
            </select>
            <div class="params">
              <label>Kernel size: <input type="number" id="kernelSize" value="5" min="3" max="11" step="2"></label>
              <label>Iterations: <input type="number" id="iterations" value="2" min="1" max="5"></label>
            </div>
            <button class="btn btn-process" data-step="morphology">
              ‚ñ∂Ô∏è X·ª≠ l√Ω B∆∞·ªõc 3
            </button>
          </div>
          
          <div class="result-container" id="resultContainer3" style="display: none;">
            <h4>‚úÖ K·∫øt qu·∫£ B∆∞·ªõc 3:</h4>
            <div class="result-preview">
              <img id="result3" src="" alt="Step 3 result">
            </div>
            <p class="result-hint">üëÜ Mask ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch. B∆∞·ªõc ti·∫øp theo s·∫Ω xu·∫•t hi·ªán b√™n d∆∞·ªõi.</p>
          </div>
        </div>
      </div>

      <!-- Step 4: Feature Analysis -->
      <div class="panel step-panel step-incomplete" id="step4" style="display: none;">
        <div class="step-header">
          <h2>üìä B∆∞·ªõc 4: Ph√¢n t√≠ch ƒë·∫∑c tr∆∞ng</h2>
          <span class="step-status" id="status4">Ch∆∞a ho√†n th√†nh</span>
        </div>
        <p class="step-description">Ph√¢n t√≠ch c√°c th√†nh ph·∫ßn v√† t√≠nh to√°n ƒë·∫∑c tr∆∞ng. Ch·ªçn ph∆∞∆°ng th·ª©c hi·ªÉn th·ªã.</p>
        
        <div class="step-content">
          <div class="algorithm-select">
            <label><strong>Ch·ªçn ph∆∞∆°ng th·ª©c hi·ªÉn th·ªã:</strong></label>
            <select id="featureAnalysisAlgo" class="algo-select">
              <option value="">-- Ch·ªçn ph∆∞∆°ng th·ª©c ph√¢n t√≠ch --</option>
              <option value="components">Connected Components - G√°n nh√£n components</option>
              <option value="area">Area Analysis - Ph√¢n t√≠ch di·ªán t√≠ch</option>
              <option value="centroid">Centroid Analysis - Ph√¢n t√≠ch t√¢m kh·ªëi</option>
              <option value="bbox">Bounding Box - V·∫Ω h·ªôp bao components</option>
            </select>
            <button class="btn btn-process" data-step="featureAnalysis">
              ‚ñ∂Ô∏è Ph√¢n t√≠ch B∆∞·ªõc 4
            </button>
          </div>
          
          <div class="result-container" id="resultContainer4" style="display: none;">
            <h4>‚úÖ K·∫øt qu·∫£ B∆∞·ªõc 4:</h4>
            <div class="result-preview">
              <img id="result4" src="" alt="Step 4 result">
            </div>
            <div id="featureStats" class="stats"></div>
            <p class="result-hint">üëÜ ƒê√£ ph√¢n t√≠ch components. B∆∞·ªõc cu·ªëi c√πng s·∫Ω xu·∫•t hi·ªán b√™n d∆∞·ªõi.</p>
          </div>
        </div>
      </div>

      <!-- Step 5: Heuristic Analysis -->
      <div class="panel step-panel step-incomplete" id="step5" style="display: none;">
        <div class="step-header">
          <h2>üéØ B∆∞·ªõc 5: Ph√¢n t√≠ch Heuristic & K·∫øt lu·∫≠n</h2>
          <span class="step-status" id="status5">Ch∆∞a ho√†n th√†nh</span>
        </div>
        <p class="step-description">B√°o c√°o t·ª± ƒë·ªông ƒë∆∞·ª£c t·∫°o sau khi ho√†n th√†nh B∆∞·ªõc 4.</p>
        
        <div class="step-content">
          <div class="result-container" id="resultContainer5" style="display: block;">
            <div id="heuristicResults" class="results-panel"></div>
          </div>
        </div>
      </div>

    </div>

    <!-- Action Buttons -->
    <div class="action-panel" id="actionPanel" style="display: none;">
      <button class="btn btn-secondary" id="resetBtn">üîÑ B·∫Øt ƒë·∫ßu l·∫°i</button>
      <button class="btn btn-secondary" id="downloadBtn">üíæ T·∫£i xu·ªëng k·∫øt qu·∫£</button>
      <button class="btn btn-secondary" id="viewHistoryBtn">üìú Xem l·ªãch s·ª≠</button>
    </div>

    <!-- History Panel -->
    <div class="panel" id="historyPanel" style="display: none;">
      <h2>üìú L·ªãch s·ª≠ x·ª≠ l√Ω</h2>
      <div id="historyList" class="history-list"></div>
    </div>

  </div>

  <script type="module" src="/js/app-pipeline.js"></script>
</body>
</html>
